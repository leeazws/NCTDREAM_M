<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>💚 NCT DREAM 전곡 소트 💚</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@latest/dist/web/static/pretendard.css">
<style>
  body { font-family: 'Pretendard', sans-serif; background: #111; color: #fff; text-align: center; margin: 0; padding: 15px; }
  
  /* 헤더 섹션 */
  h1 { font-size: 1.8rem; margin-bottom: 5px; ; }
  .subtitle { font-size: 0.9rem; color: #aaa; margin-bottom: 20px; line-height: 1.4; }
  .guide-text { font-size: 0.8rem; color: #888; display: block; margin-top: 5px; }

  /* 진행률 바 - 모바일에서 조금 더 잘 보이게 조절 */
  #progress { background: #333; border-radius: 6px; width: 100%; max-width: 500px; height: 25px; margin: 0 auto 20px; position: relative; overflow: hidden; }
  .progress-bar { background: #dcbbff; width: 0%; height: 100%; transition: width 0.3s; }
  .progress-text { position: absolute; width: 100%; left: 0; top: 0; line-height: 25px; font-size: 0.75rem; color: #fff; font-weight: bold; }

  /* 대결 구도 - 모바일 대응 */
  #battle { 
    display: flex; 
    justify-content: center; 
    align-items: flex-start;
    gap: 15px; 
    margin-bottom: 20px; 
  }

  /* 카드 디자인 - 반응형 너비 설정 */
  .card { 
    background: #222; 
    border-radius: 10px; 
    width: calc(50% - 10px); /* 모바일에서 2줄로 보임 */
    max-width: 220px; 
    cursor: pointer; 
    transition: transform 0.2s; 
    overflow: hidden; 
    border: 2px solid #333; 
  }
  .card:active { transform: scale(0.95); } /* 터치 시 피드백 */
  .card:hover { border-color: #dcbbff; }
  
  .card img.thumb { width: 100%; display: block; aspect-ratio: 16/9; object-fit: cover; }
  .card-name { 
    padding: 12px 8px; 
    font-size: 0.9rem; 
    font-weight: 600; 
    min-height: 50px; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    word-break: keep-all; /* 단어 단위 줄바꿈 */
  }

  /* 결과창 */
  #result { display: none; margin: 10px auto; width: 100%; max-width: 500px; text-align: left; background: #222; padding: 15px; border-radius: 10px; }
  .result-item { padding: 10px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; }
  .result-left { display: flex; gap: 10px; align-items: center; font-size: 0.9rem; }
  .result-rank { color: #dcbbff; font-weight: bold; width: 25px; }
  .result-percent { color: #dcbbff; font-size: 0.8rem; font-weight: bold; }

  /* 영상 모달 - 모바일 꽉 차게 */
  #videoModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); justify-content:center; align-items:center; z-index:999; flex-direction:column; }
  #videoFrame { width:95%; aspect-ratio: 16/9; border-radius:10px; border:none; }
  #closeVideo { margin-top:20px; padding:12px 30px; border:none; border-radius:5px; background:#dcbbff; cursor:pointer; color:#111; font-weight: bold; font-size: 1rem; }

  /* [모바일 전용 화면 조절] 화면이 너무 작을 때 */
  @media (max-width: 360px) {
    h1 { font-size: 1.5rem; }
    #battle { gap: 10px; }
    .card-name { font-size: 0.8rem; padding: 10px 5px; }
  }
</style>
</head>
<body>

<h1>💚 NCT DREAM 전곡 소트 💚</h1>
<div class="subtitle">[ ~BEAT IT UP🥊 ] @leeazws 
  <span class="guide-text">썸네일 클릭 : 음악 재생 ▶️, 곡명 클릭 : 선택 ☑️ (재생 안되는 곡도 있음ㅠㅠ)</span>
</div>

<div id="progress">
  <div class="progress-bar" id="progressBar"></div>
  <div class="progress-text" id="progressText">로딩 중...</div>
</div>

<div id="battle"></div>

<div id="result">
  <h2 style="text-align:center; font-size:1.5rem;">🏆 최종 결과 🏆</h2>
  <div style="text-align:center; color:#aaa; font-size:0.8rem; margin-bottom:15px;">♡엔시티드림 파이팅♡</div>
  <div id="resultList"></div>
</div>

<div id="videoModal">
  <iframe id="videoFrame" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  <button id="closeVideo">닫기</button>
</div>

<script>
// 기존 데이터 및 로직 (동일하게 유지)
const originalSongs = [
  { name: "Chewing Gum", id: "fwmvF5ffmhg" }, { name: "마지막 첫사랑 (My First and Last)", id: "4pUc7SD0PmU" },
  { name: "덩크슛 (Dunk Shot)", id: "cm5PbcKlvMU" }, { name: "We Young", id: "h3aP1cxwCyk" },
  { name: "La La Love", id: "dQCYj2qTU9k" }, { name: "같은 시간 같은 자리 (Walk You Home)", id: "NOieK5hNXMo" },
  { name: "My Page", id: "4AxjXuReUIs" }, { name: "Trigger The Fever", id: "BrFyTUakTL8" },
  { name: "Joy", id: "VMMl0DopcdM" }, { name: "Go", id: "cD8SYW8rjaQ" },
  { name: "We Go Up", id: "LV1Es22E0RI" }, { name: "1, 2, 3", id: "8SZzKS5yVuU" },
  { name: "너와 나 (Beautiful Time)", id: "LoDsQIu2c8Q" }, { name: "Drippin'", id: "VGwOCKu5kRA" },
  { name: "Dear Dream", id: "4j_HQoJOeTg" }, { name: "사랑한단 뜻이야 (Candle Light)", id: "Px-Pi5UjB40" },
  { name: "Don't Need Your Love", id: "ESVsbCkFvG4" }, { name: "Fireflies", id: "3gpoXiCQ45A" },
  { name: "BOOM", id: "X-iJZ0gfKPo" }, { name: "STRONGER", id: "g2a-sFAHzxo" },
  { name: "119", id: "LJ7GBF1s40M" }, { name: "사랑이 좀 어려워 (Bye My First...)", id: "4dxICH50SO8" },
  { name: "Best Friend", id: "bUKWmDodsMw" }, { name: "Dream Run", id: "cxWjFy8nfBA" },
  { name: "Ridin’", id: "vofjeJvRT9c" }, { name: "Quiet Down", id: "QYcw4W8kr8k" },
  { name: "내게 말해줘 (7 Days)", id: "l1vl8dENUDw" }, { name: "사랑은 또다시 (Love Again)", id: "DhSezlkvQl4" },
  { name: "너의 자리 (Puzzle Piece)", id: "2xosIrR7i5I" }, { name: "맛 (Hot Sauce)", id: "PkKnp4SdE-w" },
  { name: "Diggity", id: "5cpqXChdTTs" }, { name: "고래 (Dive Into You)", id: "R_XB-r-2fcM" },
  { name: "오르골 (Life Is Still Going On)", id: "8khwZ4Dql_k" }, { name: "우리의 계절 (My Youth)", id: "U3m82WG_5pI" },
  { name: "Rocket", id: "H7rO2CJeJx0" }, { name: "Countdown (3,2,1)", id: "_rPVvSX5O7M" },
  { name: "ANL ", id: "51v4w_MH-zg" }, { name: "주인공 (Irreplaceable)", id: "Wd-zJpV55n4" },
  { name: "지금처럼만 (Be There for You)", id: "L3lJUrqRylA" }, { name: "Rainbow (책갈피)", id: "T5a-FfbC1OA" },
  { name: "Bungee", id: "WMH5KqbjcNA" }, { name: "Hello Future", id: "QPUjV7epJqE" },
  { name: "Fire Alarm", id: "gVduOLCPK8I" }, { name: "버퍼링 (Glitch Mode)", id: "oZP2h3WIzqk" },
  { name: "Arcade", id: "IZzYeJzkoFQ" }, { name: "너를 위한 단어 (It’s Yours)", id: "6rp90Ldwc_U" },
  { name: "잘자(Teddy Bear)", id: "vyx6YPSzAZQ" }, { name: "Saturday Drip", id: "k6hSt3QjQys" },
  { name: "Better Than Gold (지금)", id: "ISSUPa56d9U" }, { name: "Replay (내일 봐)", id: "INgBXHGM-MY" },
  { name: "미니카 (Drive)", id: "LTtv3GrKWM0" }, { name: "북극성 (Never Goodbye)", id: "GhHsnZdWGDU" },
  { name: "Rewind", id: "SMUuX7zU76M" }, { name: "Beatbox", id: "bagFQCTHXy8" },
  { name: "마지막 인사 (To My First)", id: "-TJba--T2P8" }, { name: "Sorry, Heart", id: "kbA5tOml-uE" },
  { name: "별밤 (On the Way)", id: "B9eGPG1rmuw" }, { name: "Candy", id: "zuoSn3ObMz4" },
  { name: "Graduation", id: "EznbdoHi0Zs" }, { name: "Tangerine Love (Favorite)", id: "Xa1IGMtLLTU" },
  { name: "입김 (Take My Breath)", id: "UNPCDDgy4oA" }, { name: "문 (Moon)", id: "Ixufh9PoX0s" },
  { name: "발자국 (Walk With You)", id: "iCNpMiflAU4" }, { name: "Broken Melodies", id: "2R_S5TgDWMY" },
  { name: "ISTJ", id: "XDnGdcgd3Pc" }, { name: "Yogurt Shake", id: "IUs7tOzHVJw" },
  { name: "Skateboard", id: "ZyNV7Ti6JD8" }, { name: "파랑 (Blue Wave)", id: "ZkLK4hUqqas" },
  { name: "Posion (모래성)", id: "f1Cly7TQ3M0" }, { name: "SOS", id: "-Fv9UPIcpUQ" },
  { name: "Pretzel (♡)", id: "nwk_UF4YtSk" }, { name: "제자리 걸음 (Starry Night)", id: "cQiOxh07t_M" },
  { name: "Like We Just Met", id: "eA9pwL-8wJw" }, { name: "icantfeelanything", id: "LvhQKz2KZh8" },
  { name: "Smoothie", id: "qQOj-oKhItw" }, { name: "Box", id: "7pBwsU4V5pg" },
  { name: "Carat Cake", id: "_aOcdOeRjBY" }, { name: "UNKNOWN", id: "XULgWS6im8o" },
  { name: "숨 (Breathing)", id: "a1hnsBl2kKI" }, { name: "Stupid Cupid", id: "Guo0UpwtJpw" },
  { name: "Moonlight", id: "A53rrCecxtM" }, { name: "Best Friend Ever", id: "p8lbdZtjWAM" },
  { name: "Rains in Heaven", id: "6s1YRHgytwA" }, { name: "i hate fruits", id: "OsKOz9e2ZlY" },
  { name: "INTRO : DREAMSCAPE", id: "wShvjbdiTzg" }, { name: "When I’m With You", id: "B1qq8IvzSz4" },
  { name: "Flying Kiss", id: "oFRnSLNtSbc" }, { name: "No Escape", id: "6on-5rJyVOo" },
  { name: "Best of Me", id: "NuH3baf37Pc" }, { name: "YOU (숲)", id: "9i64Oh5auU0" },
  { name: "하늘을 나는 꿈 (Heavenly)", id: "L0VLpZS3pQc" }, { name: "밤 (Night Poem)", id: "NEYNwYfzVuQ" },
  { name: "Off The Wall", id: "UGLSBo7wlmM" }, { name: "CHILLER", id: "F0veX7ix4x4" },
  { name: "BTTF", id: "3rsBWr3JOUI" }, { name: "I LIKE IT", id: "SMDDNSYPTCQ" },
  { name: "DREAM TEAM", id: "gDVBHUyh7pA" }, { name: "Interlude : Back to Our Paradise", id: "BFtEI98J5IA" },
  { name: "나의 소나기 (‘Bout You)", id: "hXGwmckSP1I" }, { name: "여름 바람이 불어오면 (That Summer)", id: "c9NuEp5--Mo" },
  { name: "새벽별 (Miss Me)", id: "22eDNTdzAwk" }, { name: "항해 (Beautiful Sailing)", id: "JZVDhVs5eu0" },
  { name: "무대로 (Déjà Vu; 舞代路)", id: "Bwh5Y5bkoLk" }, { name: "Dreaming", id: "bvJ_cNsCqE4" },
  { name: "Beat It Up", id: "wvtNmMmcAYw" }, { name: "Rush", id: "E8OGtmbwzZU" },
  { name: "Cold Coffee", id: "eyn7xCJu6q0" }, { name: "Butterflies", id: "LMfcc8FeB-g" },
  { name: "Tempo (0에서 100)", id: "sqWk4Hn3sIg" }, { name: "TRICKY", id: "kT_bK9QD-T4" }
];

let songStacks = []; 
let leftList = [], rightList = [], resultTemp = [];
let currentLeftIdx = 0, currentRightIdx = 0;
let totalComparisons = 0;
let estimatedTotal = Math.floor(originalSongs.length * Math.log2(originalSongs.length));
let isFinished = false;

function initSort() {
  const shuffled = originalSongs.map(song => ({ ...song, winCount: 0, matchCount: 0 }))
                                .sort(() => Math.random() - 0.5);
  songStacks = shuffled.map(song => [song]);
  prepareNextMerge();
}

function prepareNextMerge() {
  if (songStacks.length <= 1) { showResult(); return; }
  leftList = songStacks.shift();
  rightList = songStacks.shift();
  resultTemp = [];
  currentLeftIdx = 0;
  currentRightIdx = 0;
  renderBattle();
}

function renderBattle() {
  updateProgress();
  const battleDiv = document.getElementById("battle");
  battleDiv.innerHTML = "";
  const songL = leftList[currentLeftIdx];
  const songR = rightList[currentRightIdx];
  songL.matchCount++; songR.matchCount++;

  [songL, songR].forEach((song, idx) => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<img src="https://img.youtube.com/vi/${song.id}/0.jpg" class="thumb"><div class="card-name">${song.name}</div>`;
    
    card.querySelector(".thumb").onclick = (e) => {
      e.stopPropagation();
      document.getElementById("videoFrame").src = `https://www.youtube.com/embed/${song.id}?autoplay=1`;
      document.getElementById("videoModal").style.display = "flex";
    };

    card.onclick = () => selectSong(idx === 0 ? "left" : "right");
    battleDiv.appendChild(card);
  });
}

function selectSong(winner) {
  totalComparisons++;
  if (winner === "left") { leftList[currentLeftIdx].winCount++; resultTemp.push(leftList[currentLeftIdx]); currentLeftIdx++; } 
  else { rightList[currentRightIdx].winCount++; resultTemp.push(rightList[currentRightIdx]); currentRightIdx++; }

  if (currentLeftIdx < leftList.length && currentRightIdx < rightList.length) { renderBattle(); } 
  else {
    resultTemp = resultTemp.concat(currentLeftIdx < leftList.length ? leftList.slice(currentLeftIdx) : rightList.slice(currentRightIdx));
    songStacks.push(resultTemp);
    prepareNextMerge();
  }
}

function updateProgress() {
  let percent = Math.min(99.9, (totalComparisons / estimatedTotal) * 100).toFixed(1);
  if (isFinished) percent = "100";
  document.getElementById("progressBar").style.width = percent + "%";
  document.getElementById("progressText").innerText = `${totalComparisons} / ${estimatedTotal} (${percent}%)`;
}

function showResult() {
  isFinished = true;
  updateProgress();
  document.getElementById("battle").style.display = "none";
  document.getElementById("progress").style.display = "none";
  document.getElementById("result").style.display = "block";
  const list = document.getElementById("resultList");
  
  const sortedResult = songStacks[0].sort((a, b) => (b.winCount / b.matchCount) - (a.winCount / a.matchCount));

  sortedResult.forEach((song, i) => {
    const winRate = ((song.winCount / song.matchCount) * 100).toFixed(1);
    list.innerHTML += `
      <div class="result-item">
        <div class="result-left"><span class="result-rank">${i+1}</span><span>${song.name}</span></div>
        <span class="result-percent">${winRate}%</span>
      </div>`;
  });
}

document.getElementById("closeVideo").onclick = () => {
  document.getElementById("videoFrame").src = "";
  document.getElementById("videoModal").style.display = "none";
};

initSort();
</script>
</body>
</html>